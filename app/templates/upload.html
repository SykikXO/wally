{% extends "base.html" %}

{% block content %}
<div style="max-width: 500px; margin: 0 auto;">
    <h2>Upload Wallpaper</h2>
    <form action="" method="post" enctype="multipart/form-data" id="uploadForm"
        style="background: transparent; padding: 2rem; border: 1px dashed var(--dim); margin-top: 2rem;">
        <div style="margin-bottom: 2rem;">
            <label for="file" style="display: block; margin-bottom: 0.8rem; font-weight: bold;">Choose
                Wallpapers</label>
            <p style="font-size: 0.8rem; color: var(--dim); margin-bottom: 1rem;">Max 10 files, 300MB total</p>
            <input type="file" name="file" id="file" accept="image/*" multiple required>
            <div id="fileError" style="color: var(--error); margin-top: 0.5rem; font-size: 0.9rem;"></div>
        </div>

        <div style="margin-bottom: 2rem;">
            <label for="tags" style="display: block; margin-bottom: 0.8rem; font-weight: bold;">Tags</label>
            <input type="text" name="tags" id="tags" placeholder="nature, dark, 4k" style="margin-bottom: 0;">
            <p style="font-size: 0.8rem; color: var(--dim); margin-top: 0.5rem;">Separated by commas</p>
        </div>

        <button type="submit" class="btn" style="width: 100%;">Upload to Library</button>
    </form>


    <script>
        const form = document.getElementById('uploadForm');
        const fileInput = document.getElementById('file');
        const errorDiv = document.getElementById('fileError');
        const MAX_FILES = 10;
        const MAX_SIZE_BYTES = 300 * 1024 * 1024; // 300MB
        const IS_ADMIN = JSON.parse('{{ current_user.is_admin }}');

        form.addEventListener('submit', function (e) {
            errorDiv.textContent = '';

            if (IS_ADMIN) return;

            const files = fileInput.files;

            if (files.length > MAX_FILES) {
                e.preventDefault();
                errorDiv.textContent = `You can only upload a maximum of ${MAX_FILES} files at a time.`;
                return;
            }


            let totalSize = 0;
            for (let i = 0; i < files.length; i++) {
                totalSize += files[i].size;
            }

            if (totalSize > MAX_SIZE_BYTES) {
                e.preventDefault();
                errorDiv.textContent = `Total file size exceeds 300MB. Current: ${(totalSize / (1024 * 1024)).toFixed(2)}MB`;
                return;
            }
        });
    </script>

</div>
{% endblock %}